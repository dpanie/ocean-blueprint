<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Quiz Game | Ocean Blueprint</title>

  <style>
    /* ===============================
       THEME + GLOBAL (matches OA page)
       =============================== */
    :root{
      --bg: #071018;
      --text: rgba(255,255,255,0.92);
      --muted: rgba(255,255,255,0.78);
      --muted2: rgba(255,255,255,0.70);
      --line: rgba(255,255,255,0.12);
      --accent: #78beff;
      --accent2: rgba(120,190,255,0.18);
      --shadow: 0 22px 70px rgba(0,0,0,0.45);
      --shadow2: 0 10px 26px rgba(0,0,0,0.35);
      --radius: 18px;
    }

    *{ box-sizing:border-box; }
    html,body{ height:100%; }

    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
      background:
        radial-gradient(1200px 900px at 70% 10%, rgba(120,190,255,0.14), transparent 55%),
        radial-gradient(900px 700px at 20% 80%, rgba(120,190,255,0.08), transparent 55%),
        var(--bg);
      color: var(--text);
      font-size: 18px;
      line-height: 1.65;
      -webkit-font-smoothing: antialiased;
      text-rendering: optimizeLegibility;
    }

    a{ color:inherit; }
    a:focus-visible{
      outline: 3px solid rgba(120,190,255,0.55);
      outline-offset: 3px;
      border-radius: 10px;
    }

    /* ===== Topbar ===== */
    .topbar{
      position: sticky;
      top: 0;
      z-index: 30;
      height: 72px;
      display:flex;
      align-items:center;
      justify-content: space-between;
      gap: 14px;
      padding: 0 18px;
      background: rgba(7,16,24,0.74);
      backdrop-filter: blur(10px);
      border-bottom: 1px solid rgba(255,255,255,0.10);
    }

    .brand{
      font-weight: 750;
      letter-spacing: 0.2px;
      font-size: 16px;
      white-space: nowrap;
      display:flex;
      align-items:center;
      gap: 10px;
    }
    .brand-dot{
      width: 10px;
      height: 10px;
      border-radius: 999px;
      background: var(--accent);
      box-shadow: 0 0 0 4px var(--accent2);
    }

    .nav{
      display:flex;
      gap: 8px;
      flex-wrap: wrap;
      justify-content: flex-end;
    }
    .nav-btn{
      text-decoration:none;
      padding: 9px 12px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,0.14);
      background: rgba(255,255,255,0.04);
      color: rgba(255,255,255,0.90);
      font-size: 14px;
      transition: transform .12s ease, background .12s ease, border-color .12s ease;
    }
    .nav-btn:hover{
      background: rgba(255,255,255,0.09);
      border-color: rgba(255,255,255,0.26);
      transform: translateY(-1px);
    }

    /* ===== Page container ===== */
    .page{
      width: min(1120px, calc(100% - 40px));
      margin: 0 auto;
      padding: 18px 0 42px;
    }

    /* ===== Kicker ===== */
    .kicker{
      display:inline-flex;
      align-items:center;
      gap:10px;
      color: rgba(255,255,255,0.82);
      font-size: 13px;
      letter-spacing: 0.4px;
      text-transform: uppercase;
    }
    .kicker-dot{
      width: 10px;
      height: 10px;
      border-radius: 999px;
      background: var(--accent);
      box-shadow: 0 0 0 4px var(--accent2);
    }

    /* ===============================
       QUIZ HERO (full-bleed)
       =============================== */
    .quiz-hero{
      width: 100vw;
      margin-left: calc(50% - 50vw);
      margin-right: calc(50% - 50vw);
      min-height: calc(100vh - 72px);
      display: grid;
      align-items: center;
      text-align: center;
      overflow: hidden;
      box-shadow: var(--shadow);
      background:
        linear-gradient(180deg, rgba(0,0,0,0.10) 0%, rgba(0,0,0,0.88) 82%),
        radial-gradient(1000px 520px at 70% 18%, rgba(120,190,255,0.18), transparent 60%),
        url("assets/images/game-bg.jpg");
      background-size: cover;
      background-position: center;
    }

    .quiz-hero-inner{
      text-align: center;
      padding: 44px 22px 28px;
      max-width: 980px;
      margin: 0 auto;
    }

    .quiz-hero h1{
      margin: 14px 0 0;
      font-size: clamp(40px, 5.2vw, 78px);
      letter-spacing: -0.8px;
      line-height: 1.05;
    }

    .quiz-hero p{
      margin: 18px auto 0;
      max-width: 980px;
      color: rgba(255,255,255,0.90);
      font-size: clamp(18px, 2.0vw, 24px);
      line-height: 1.7;
      font-weight: 520;
    }

    /* ===== Wrap ===== */
    .quiz-wrap{
      margin-top: 18px;
      background: rgba(255,255,255,0.05);
      border: 1px solid rgba(255,255,255,0.12);
      border-radius: 18px;
      padding: 18px;
      box-shadow: var(--shadow2);
    }

    .quiz-head{
      display: grid;
      gap: 8px;
      margin-bottom: 14px;
    }
    .quiz-head h2{
      margin: 0;
      font-size: 22px;
      letter-spacing: -0.2px;
    }
    .quiz-head .note{
      margin: 0;
      color: rgba(255,255,255,0.72);
      font-size: 16.5px;
      line-height: 1.6;
    }

    /* ===== One-question layout ===== */
    .quiz-one{
      margin-top: 14px;
      display: grid;
      gap: 14px;
    }

    .quiz-progress{
      padding: 12px;
      border-radius: 16px;
      background: rgba(0,0,0,0.22);
      border: 1px solid rgba(255,255,255,0.10);
    }
    .quiz-progress-top{
      display: flex;
      justify-content: space-between;
      align-items: baseline;
      gap: 12px;
      flex-wrap: wrap;
      margin-bottom: 8px;
    }
    .quiz-progress-title{
      font-weight: 900;
      letter-spacing: -0.2px;
      color: rgba(255,255,255,0.92);
      font-size: 18px;
    }
    .quiz-progress-mini{
      font-size: 12px;
      color: rgba(255,255,255,0.65);
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    .quiz-progress-bar{
      height: 10px;
      border-radius: 999px;
      overflow: hidden;
      background: rgba(255,255,255,0.08);
      border: 1px solid rgba(255,255,255,0.10);
    }
    .quiz-progress-fill{
      height: 100%;
      width: 0%;
      background: rgba(120,190,255,0.90);
      transition: width 220ms ease;
    }

    /* ===============================
       AESTHETIC UPGRADE: QUESTION CARD
       =============================== */
    .quiz-card{
      min-height: calc(100vh - 72px - 220px - 18px - 18px - 24px);
      border-radius: 24px;
      border: 1px solid rgba(255,255,255,0.12);
      background:
        radial-gradient(900px 520px at 20% 10%, rgba(120,190,255,0.14), transparent 55%),
        linear-gradient(180deg, rgba(255,255,255,0.06), rgba(0,0,0,0.34));
      padding: clamp(18px, 3vw, 34px);
      box-shadow: 0 18px 60px rgba(0,0,0,0.45);
      display: grid;
      align-content: start;
      gap: 16px;
      position: relative;
      overflow: hidden;
    }

    /* subtle corner sheen */
    .quiz-card::before{
      content:"";
      position:absolute;
      inset:-2px;
      background:
        radial-gradient(700px 260px at 10% 0%, rgba(255,255,255,0.10), transparent 60%),
        radial-gradient(600px 260px at 90% 0%, rgba(120,190,255,0.10), transparent 60%);
      pointer-events:none;
      opacity: 0.9;
    }

    .q-head{
      position: relative;
      z-index: 1;
      display:flex;
      align-items:center;
      justify-content: space-between;
      gap: 12px;
      flex-wrap: wrap;
      padding-bottom: 10px;
      border-bottom: 1px solid rgba(255,255,255,0.10);
    }

    .q-pill{
      display:inline-flex;
      align-items:center;
      gap: 10px;
      padding: 8px 12px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,0.14);
      background: rgba(0,0,0,0.22);
      color: rgba(255,255,255,0.88);
      font-weight: 800;
      letter-spacing: 0.2px;
      font-size: 14px;
    }

    .q-pill-dot{
      width: 9px;
      height: 9px;
      border-radius: 999px;
      background: rgba(120,190,255,0.95);
      box-shadow: 0 0 0 4px rgba(120,190,255,0.14);
    }

    .q-counter{
      color: rgba(255,255,255,0.70);
      font-size: 14px;
      font-weight: 800;
      letter-spacing: 0.3px;
    }

    .q-title{
      position: relative;
      z-index: 1;
      margin: 0;
      font-size: clamp(22px, 2.3vw, 32px);
      font-weight: 950;
      letter-spacing: -0.5px;
      color: rgba(255,255,255,0.95);
      line-height: 1.2;
    }

    .answers{
      position: relative;
      z-index: 1;
      display: grid;
      gap: 12px;
      margin-top: 6px;
    }

    /* Answer tiles */
    .opt{
      display: grid;
      grid-template-columns: 40px 22px 1fr;
      gap: 12px;
      align-items: start;
      padding: 14px 14px;
      border-radius: 18px;
      border: 1px solid rgba(255,255,255,0.12);
      background:
        linear-gradient(180deg, rgba(255,255,255,0.06), rgba(0,0,0,0.12));
      cursor: pointer;
      user-select: none;
      transition: transform .12s ease, border-color .12s ease, background .12s ease;
    }

    .opt:hover{
      border-color: rgba(120,190,255,0.55);
      background:
        linear-gradient(180deg, rgba(120,190,255,0.12), rgba(0,0,0,0.10));
      transform: translateY(-1px);
    }

    .opt input{
      margin-top: 4px;
      accent-color: rgba(120,190,255,0.95);
    }

    .opt span{
      font-size: clamp(16px, 1.2vw, 19px);
      color: rgba(255,255,255,0.88);
      line-height: 1.45;
    }

    /* Letter badge */
    .opt-badge{
      display:flex;
      align-items:center;
      justify-content:center;
      width: 40px;
      height: 40px;
      border-radius: 14px;
      background: rgba(0,0,0,0.22);
      border: 1px solid rgba(255,255,255,0.12);
      color: rgba(255,255,255,0.86);
      font-weight: 950;
      letter-spacing: 0.6px;
    }

    /* Selected state: when input checked, style the whole card */
    .opt:has(input:checked){
      border-color: rgba(120,190,255,0.70);
      background:
        linear-gradient(180deg, rgba(120,190,255,0.16), rgba(0,0,0,0.12));
      box-shadow: 0 10px 24px rgba(0,0,0,0.35);
    }
    .opt:has(input:checked) .opt-badge{
      background: rgba(120,190,255,0.16);
      border-color: rgba(120,190,255,0.40);
      color: rgba(255,255,255,0.95);
    }

    .quiz-actions{
      position: relative;
      z-index: 1;
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      align-items: center;
      margin-top: 6px;
    }

    .btn{
      display: inline-flex;
      align-items: center;
      justify-content: center;
      border-radius: 14px;
      padding: 12px 14px;
      border: 1px solid rgba(255,255,255,0.14);
      background: rgba(255,255,255,0.06);
      color: rgba(255,255,255,0.92);
      text-decoration: none;
      font-weight: 900;
      letter-spacing: 0.2px;
      cursor: pointer;
      user-select: none;
      transition: transform .12s ease, border-color .12s ease, background .12s ease;
    }
    .btn:hover{
      border-color: rgba(120,190,255,0.55);
      transform: translateY(-1px);
    }
    .btn:disabled{
      opacity: 0.55;
      cursor: not-allowed;
      transform: none;
    }
    .btn-primary{
      background: rgba(255,255,255,0.92);
      color: #0b0b0b;
      border-color: rgba(255,255,255,0.22);
    }

    .inline-warn{
      position: relative;
      z-index: 1;
      margin-top: 6px;
      padding: 12px 14px;
      border-radius: 16px;
      background: rgba(255,255,255,0.04);
      border: 1px solid rgba(255,255,255,0.10);
      color: rgba(255,255,255,0.82);
      font-size: 16px;
      line-height: 1.55;
      display: none;
    }
    .inline-warn.show{ display: block; }

    /* Result screen */
    .result{
      position: relative;
      z-index: 1;
      margin-top: 6px;
      padding: 16px;
      border-radius: 18px;
      border: 1px solid rgba(255,255,255,0.12);
      background: rgba(0,0,0,0.35);
      display: none;
    }
    .result.show{ display: block; }

    .result-top{
      display: flex;
      flex-wrap: wrap;
      gap: 10px 14px;
      align-items: baseline;
    }
    .score{
      font-size: 32px;
      font-weight: 900;
      letter-spacing: -0.4px;
    }
    .badge{
      font-size: 12px;
      padding: 6px 10px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,0.14);
      background: rgba(255,255,255,0.06);
      color: rgba(255,255,255,0.85);
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    .result p{
      margin: 10px 0 0;
      color: rgba(255,255,255,0.80);
      line-height: 1.6;
      font-size: 16.5px;
    }
    .warn{
      margin-top: 10px;
      padding: 12px;
      border-radius: 14px;
      background: rgba(255,255,255,0.04);
      border: 1px solid rgba(255,255,255,0.10);
      color: rgba(255,255,255,0.84);
      font-size: 16.5px;
      line-height: 1.6;
    }
    .small{
      margin-top: 10px;
      color: rgba(255,255,255,0.60);
      font-size: 14px;
      line-height: 1.55;
    }

    /* Footer */
    .footer{
      text-align: center;
      padding: 18px 12px;
      border-top: 1px solid rgba(255,255,255,0.12);
      color: rgba(255,255,255,0.70);
      background: rgba(7,16,24,0.5);
      backdrop-filter: blur(8px);
      margin-top: 10px;
    }

    @media (max-width: 900px){
      .quiz-wrap{ padding: 14px; }
      .quiz-card{ min-height: calc(100vh - 72px - 220px - 14px - 14px - 24px); }
      .opt{ grid-template-columns: 40px 22px 1fr; }
    }

    @media (prefers-reduced-motion: reduce){
      .nav-btn, .btn, .quiz-progress-fill, .opt{ transition: none; }
    }
  </style>
</head>

<body>
  <header class="topbar">
    <div class="brand"><span class="brand-dot" aria-hidden="true"></span>Ocean Blueprint</div>
    <nav class="nav" aria-label="Primary navigation">
      <a class="nav-btn" href="index.html">Home</a>
      <a class="nav-btn" href="what-is-acidification.html">What is OA?</a>
      <a class="nav-btn" href="why-it-matters.html">Why it matters</a>
      <a class="nav-btn" href="solutions.html">Solutions</a>
      <a class="nav-btn" href="take-action.html">Take action</a>
      <a class="nav-btn" href="game.html" aria-current="page">Game</a>
    </nav>
  </header>

  <main>
    <section class="quiz-hero" aria-label="Quiz introduction">
      <div class="quiz-hero-inner">
        <div class="kicker"><span class="kicker-dot" aria-hidden="true"></span>Interactive quiz</div>
        <h1>What choices most affect your ocean impact?</h1>
        <p>
          Ten quick questions. No math required. At the end, you’ll get a score and a few high-impact next steps.
        </p>
      </div>
    </section>

    <section class="page">
      <section class="quiz-wrap">
        <div class="quiz-head">
          <h2>How it works</h2>
          <p class="note">
            Pick the answer that matches what you do most of the time. The scoring is hidden so people focus on choices, not gaming the result.
          </p>
        </div>

        <form id="quiz" class="quiz-one">
          <div class="quiz-progress">
            <div class="quiz-progress-top">
              <div class="quiz-progress-title">Question <span id="qNum">1</span> / <span id="qTotal">10</span></div>
              <div class="quiz-progress-mini" id="qCat">—</div>
            </div>
            <div class="quiz-progress-bar">
              <div class="quiz-progress-fill" id="progressFill"></div>
            </div>
          </div>

          <section class="quiz-card" aria-live="polite">
            <!-- NEW: attractive header row -->
            <div class="q-head">
              <div class="q-pill"><span class="q-pill-dot" aria-hidden="true"></span><span id="qCatPill">—</span></div>
              <div class="q-counter"><span id="qNumPill">1</span> / <span id="qTotalPill">10</span></div>
            </div>

            <h3 class="q-title" id="questionText">—</h3>
            <div class="answers" id="answersWrap"></div>

            <div class="inline-warn" id="inlineWarn">
              Please choose one option to continue.
            </div>

            <div class="quiz-actions">
              <button class="btn" type="button" id="back">Back</button>
              <button class="btn btn-primary" type="button" id="next">Next</button>
              <button class="btn" type="button" id="reset">Reset</button>
            </div>

            <div class="result" id="result">
              <div class="result-top">
                <div class="score" id="scoreText">Score: 0</div>
                <div class="badge" id="badgeText">—</div>
              </div>
              <p id="msg"></p>
              <div class="warn" id="nextStep"></div>
              <div class="small" id="meta"></div>

              <div class="quiz-actions" style="margin-top: 12px;">
                <button class="btn btn-primary" type="button" id="share">Share score</button>
                <button class="btn" type="button" id="restart">Restart quiz</button>
              </div>
            </div>
          </section>
        </form>
      </section>
    </section>
  </main>

  <footer class="footer">
    <p>© <span id="year"></span> Ocean Blueprint</p>
  </footer>

  <script>
    document.getElementById("year").textContent = new Date().getFullYear();

    const QUESTIONS = [
      { id: "q1", cat: "Transportation", text: "1. For most short trips (under ~3 miles), what do you usually do?",
        opts: [
          { label: "Walk or bike", pts: 0 },
          { label: "Public transit", pts: 1 },
          { label: "Carpool or shared ride", pts: 2 },
          { label: "Drive alone", pts: 3 },
        ]
      },
      { id: "q2", cat: "Transportation", text: "2. About how many flights do you take in a typical year?",
        opts: [
          { label: "0–1", pts: 0 },
          { label: "2–3", pts: 2 },
          { label: "4–6", pts: 3 },
          { label: "7+", pts: 4 },
        ]
      },
      { id: "q3", cat: "Home energy", text: "3. What best describes your home electricity plan or source?",
        opts: [
          { label: "Mostly renewable (or a green-energy plan)", pts: 0 },
          { label: "A mix (some renewables, not sure how much)", pts: 1 },
          { label: "Mostly fossil-based", pts: 2 },
          { label: "I don’t know and haven’t checked", pts: 3 },
        ]
      },
      { id: "q4", cat: "Home energy", text: "4. In winter or summer, how do you handle heating/cooling most of the time?",
        opts: [
          { label: "I use efficient settings (layering, moderate thermostat, fans)", pts: 0 },
          { label: "Somewhat careful, but not consistent", pts: 1 },
          { label: "I keep it very warm/cool for comfort", pts: 2 },
          { label: "I rarely think about it at all", pts: 3 },
        ]
      },
      { id: "q5", cat: "Food", text: "5. How often do you eat beef or lamb (the highest-impact meats)?",
        opts: [
          { label: "Never or almost never", pts: 0 },
          { label: "1–2 times a week", pts: 1 },
          { label: "3–5 times a week", pts: 2 },
          { label: "Most days", pts: 3 },
        ]
      },
      { id: "q6", cat: "Food", text: "6. How much food do you throw away in a normal week?",
        opts: [
          { label: "Almost none (I plan meals / use leftovers)", pts: 0 },
          { label: "A little (some leftovers go bad)", pts: 1 },
          { label: "A noticeable amount", pts: 2 },
          { label: "I don’t track it", pts: 3 },
        ]
      },
      { id: "q7", cat: "Consumption", text: "7. When you need something (clothes, tech, accessories), what do you usually do first?",
        opts: [
          { label: "Repair / borrow / buy secondhand", pts: 0 },
          { label: "Mix of secondhand and new", pts: 1 },
          { label: "Usually buy new, but not often", pts: 2 },
          { label: "Buy new frequently", pts: 3 },
        ]
      },
      { id: "q8", cat: "Waste", text: "8. How often do you use single-use items (bottles, cups, bags, utensils)?",
        opts: [
          { label: "Rarely (I carry reusables)", pts: 0 },
          { label: "Sometimes", pts: 1 },
          { label: "Often", pts: 2 },
          { label: "Most days", pts: 3 },
        ]
      },
      { id: "q9", cat: "Water & chemicals", text: "9. What happens to chemicals around your home (cleaners, paint, oil, fertilizer)?",
        opts: [
          { label: "Careful: proper disposal and minimal use", pts: 0 },
          { label: "I try to be careful, but I’m not always sure", pts: 1 },
          { label: "Sometimes they end up in trash/drains/runoff", pts: 2 },
          { label: "I don’t really think about it", pts: 3 },
        ]
      },
      { id: "q10", cat: "Action", text: "10. In the past 6 months, which best describes your climate/ocean action?",
        opts: [
          { label: "I made a concrete change and stuck with it", pts: 0 },
          { label: "I tried one change but it didn’t last", pts: 1 },
          { label: "I’ve mostly learned/read, but not changed habits", pts: 2 },
          { label: "I haven’t done anything specific", pts: 3 },
        ]
      },
    ];

    // ===== DOM =====
    const qNumEl = document.getElementById("qNum");
    const qTotalEl = document.getElementById("qTotal");
    const qCatEl = document.getElementById("qCat");
    const progressFill = document.getElementById("progressFill");

    const qCatPill = document.getElementById("qCatPill");
    const qNumPill = document.getElementById("qNumPill");
    const qTotalPill = document.getElementById("qTotalPill");

    const questionText = document.getElementById("questionText");
    const answersWrap = document.getElementById("answersWrap");

    const backBtn = document.getElementById("back");
    const nextBtn = document.getElementById("next");
    const resetBtn = document.getElementById("reset");

    const inlineWarn = document.getElementById("inlineWarn");

    const result = document.getElementById("result");
    const scoreText = document.getElementById("scoreText");
    const badgeText = document.getElementById("badgeText");
    const msg = document.getElementById("msg");
    const nextStep = document.getElementById("nextStep");
    const meta = document.getElementById("meta");
    const shareBtn = document.getElementById("share");
    const restartBtn = document.getElementById("restart");

    // ===== State =====
    let currentIndex = 0;
    const answers = {}; // { qid: pts }
    const LETTERS = ["A","B","C","D","E","F"];

    qTotalEl.textContent = String(QUESTIONS.length);
    qTotalPill.textContent = String(QUESTIONS.length);

    function rating(total){
      if (total <= 8) {
        return { badge: "Low Impact",
          text: "Your choices are already aligned with lower emissions. That matters for ocean chemistry.",
          step: "Next step: pick one lever to strengthen (transport, food, or energy) and make it consistent for 2 weeks."
        };
      }
      if (total <= 16) {
        return { badge: "Moderate Impact",
          text: "You’re doing some good things, but there are a few high-impact upgrades available.",
          step: "Next step: choose two changes that are realistic to sustain (for example: fewer flights + less beef, or fewer solo drives + less new buying)."
        };
      }
      if (total <= 24) {
        return { badge: "High Impact",
          text: "Your habits likely contribute noticeably to emissions. The biggest wins come from a few major categories.",
          step: "Next step: choose ONE category to tackle first (transport, food, or home energy) and make a specific plan for this month."
        };
      }
      return { badge: "Very High Impact",
        text: "Your score suggests a higher footprint. If you want to lower it, focus on the biggest levers rather than small tweaks.",
        step: "Next step: start with one structural change you can maintain (e.g., fewer flights or less beef) and add a second once it becomes routine."
      };
    }

    function renderQuestion(){
      inlineWarn.classList.remove("show");
      result.classList.remove("show");

      const q = QUESTIONS[currentIndex];

      qNumEl.textContent = String(currentIndex + 1);
      qCatEl.textContent = q.cat;

      qNumPill.textContent = String(currentIndex + 1);
      qCatPill.textContent = q.cat;

      const pct = ((currentIndex) / QUESTIONS.length) * 100;
      progressFill.style.width = `${pct}%`;

      questionText.textContent = q.text;
      answersWrap.innerHTML = "";

      q.opts.forEach((opt, idx) => {
        const id = `${q.id}_opt_${idx}`;

        const label = document.createElement("label");
        label.className = "opt";
        label.setAttribute("for", id);

        const badge = document.createElement("div");
        badge.className = "opt-badge";
        badge.textContent = LETTERS[idx] ?? String(idx + 1);

        const input = document.createElement("input");
        input.type = "radio";
        input.name = q.id;
        input.id = id;
        input.value = String(opt.pts);

        if (answers[q.id] !== undefined && Number(input.value) === answers[q.id]) input.checked = true;

        input.addEventListener("change", () => {
          answers[q.id] = Number(input.value);
          inlineWarn.classList.remove("show");
          if (currentIndex === QUESTIONS.length - 1) nextBtn.textContent = "Finish";
        });

        const span = document.createElement("span");
        span.textContent = opt.label;

        label.appendChild(badge);
        label.appendChild(input);
        label.appendChild(span);
        answersWrap.appendChild(label);
      });

      backBtn.disabled = currentIndex === 0;
      nextBtn.textContent = (currentIndex === QUESTIONS.length - 1) ? "Finish" : "Next";
    }

    function computeTotal(){
      let total = 0;
      for (const q of QUESTIONS) total += Number(answers[q.id] ?? 0);
      return total;
    }

    function firstMissingIndex(){
      for (let i = 0; i < QUESTIONS.length; i++) {
        if (answers[QUESTIONS[i].id] === undefined) return i;
      }
      return -1;
    }

    function showResults(){
      const total = computeTotal();
      const r = rating(total);

      progressFill.style.width = "100%";

      result.classList.add("show");
      scoreText.textContent = `Score: ${total}`;
      badgeText.textContent = r.badge;
      msg.textContent = r.text;
      nextStep.textContent = r.step;
      meta.textContent = "This is a simplified reflection tool, not a precise footprint calculator.";

      backBtn.disabled = true;
      nextBtn.disabled = true;

      result.scrollIntoView({ behavior: "smooth", block: "center" });
    }

    function resetQuiz(){
      currentIndex = 0;
      for (const k of Object.keys(answers)) delete answers[k];
      backBtn.disabled = true;
      nextBtn.disabled = false;
      nextBtn.textContent = "Next";
      renderQuestion();
      window.scrollTo({ top: 0, behavior: "smooth" });
    }

    backBtn.addEventListener("click", () => {
      inlineWarn.classList.remove("show");
      if (currentIndex > 0) currentIndex--;
      renderQuestion();
    });

    nextBtn.addEventListener("click", () => {
      const q = QUESTIONS[currentIndex];
      if (answers[q.id] === undefined) {
        inlineWarn.classList.add("show");
        return;
      }

      if (currentIndex === QUESTIONS.length - 1) {
        const missing = firstMissingIndex();
        if (missing !== -1) {
          currentIndex = missing;
          renderQuestion();
          inlineWarn.textContent = "Please answer this question to continue.";
          inlineWarn.classList.add("show");
          return;
        }
        showResults();
        return;
      }

      currentIndex++;
      renderQuestion();
    });

    resetBtn.addEventListener("click", () => resetQuiz());

    restartBtn.addEventListener("click", () => {
      backBtn.disabled = false;
      nextBtn.disabled = false;
      resetQuiz();
    });

    shareBtn.addEventListener("click", async () => {
      const missing = firstMissingIndex();
      if (missing !== -1) {
        currentIndex = missing;
        renderQuestion();
        inlineWarn.textContent = "Please finish the quiz before sharing your score.";
        inlineWarn.classList.add("show");
        return;
      }

      const total = computeTotal();
      const r = rating(total);
      const text = `I got "${r.badge}" on the Ocean Blueprint quiz (score: ${total}). Try it: ${window.location.href}`;

      try {
        if (navigator.share) {
          await navigator.share({ title: "Ocean Blueprint Quiz", text, url: window.location.href });
        } else {
          await navigator.clipboard.writeText(text);
          shareBtn.textContent = "Copied!";
          setTimeout(() => shareBtn.textContent = "Share score", 1200);
        }
      } catch (e) {}
    });

    renderQuestion();
  </script>
</body>
</html>
